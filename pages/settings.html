<h2 class="win-h2">Settings</h2>
<br/>
<br/>
<div class="container">
    <div class="row">
        <h3 class="win-h3">Arma Pfad</h3>
        <br/>
        <div class="input-group">
            <input type="text" id="armapath" class="form-control" placeholder="Kein Arma Pfad gefunden" aria-describedby="basic-addon2" readonly>
            <span class="input-group-btn">
                <button class="btn btn-secondary" id="armapathbtn" type="button" data-role="popover" data-popover-shadow="true" data-popover-position="top" data-popover-text="Wähle deine arma3.exe aus!" data-popover-background="bg-red" data-popover-color="fg-white">...</button>
              </span>
        </div>
    </div>
    <br/>
    <div class="row">
        <h3 class="win-h3">Arma Startparameter</h3>
        <div class="col-md-12">
            <table>
                <tr>
                    <td>
                        <h5 class="win-h5">Kein Splashscreen:&nbsp;&nbsp;</h5>
                    </td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" id="splashswitch">
                            <span class="check"></span>
                        </label>
                    </td>
                    <td style="width:10%">
                    </td>
                    <td>
                        <h5 class="win-h5">Max. Mem:&nbsp;&nbsp;</h5>
                    </td>
                    <td>
                      <div class="input-control text" data-role="input">
                        <input type="number" id="meminput" style="color:#444444">
                        <button class="button" id="membutton" data-role="popover" data-popover-mode="click" data-popover-position="right" data-popover-text="Die Maximale Menge Arbeitsspeicher die Arma verwenden darf" data-popover-background="bg-cyan" data-popover-color="fg-white"><span class="mif-info"></span></button>
                      </div>
                    </td>

                </tr>
                <tr>
                    <td>
                        <h5 class="win-h5">Intro Überspringen:&nbsp;&nbsp;</h5>
                    </td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" id="introswitch">
                            <span class="check"></span>
                        </label>
                    </td>
                    <td style="width:10%">
                    </td>
                    <td>
                        <h5 class="win-h5">CPU Count:&nbsp;&nbsp;</h5>
                    </td>
                    <td>
                      <div class="input-control text" data-role="input">
                        <input type="number" id="cpuinput" style="color:#444444">
                        <button class="button" id="cpubutton" data-role="popover" data-popover-mode="click" data-popover-position="right" data-popover-text="Gleich oder weniger als deine nativen CPU Kerne" data-popover-background="bg-cyan" data-popover-color="fg-white"><span class="mif-info"></span></button>
                      </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <h5 class="win-h5">Nutze Hyper-threading:&nbsp;&nbsp;</h5>
                    </td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" id="htswitch">
                            <span class="check"></span>
                        </label>
                    </td>
                    <td style="width:10%">
                    </td>
                    <td>
                        <h5 class="win-h5">Max. vRAM:&nbsp;&nbsp;</h5>
                    </td>
                    <td>
                      <div class="input-control text" data-role="input">
                      <input type="number" id="vraminput" style="color:#444444">
                      <button class="button" id="vrambutton" data-role="popover" data-popover-mode="click" data-popover-position="right" data-popover-text="Die Maximale Menge Grafikspeicher die Arma verwenden darf" data-popover-background="bg-cyan" data-popover-color="fg-white"><span class="mif-info"></span></button>
                    </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <h5 class="win-h5">Fenstermodus:&nbsp;&nbsp;</h5>
                    </td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" id="windowedswitch">
                            <span class="check"></span>
                        </label>
                    </td>
                    <td style="width:10%">
                    </td>
                    <td>
                        <h5 class="win-h5">Ex. Threads:&nbsp;&nbsp;</h5>
                    </td>
                    <td>
                        <div class="input-control text" data-role="input">
                          <input type="number" id="threadinput" style="color:#444444">
                          <button class="button" id="threadbutton" data-role="popover" data-popover-mode="click" data-popover-position="right" data-popover-text="3 für Dualcore <br> 7 für Quadcore" data-popover-background="bg-cyan" data-popover-color="fg-white"><span class="mif-info"></span></button>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>
<script>
    $(document).ready(function() {
        timert = true;
        loadallsettings();
    });

    var toggleWifi = function() {
        var obj = document.getElementById("wifiToggle").winControl;
        console.log("Wifi toggled. Current status: " + (obj.checked ? "on" : "off"));
    }

    document.getElementById("armapathbtn").addEventListener("click", function() {
        var options = {
            filters: [{
                name: 'Arma3.exe',
                extensions: ['exe']
            }, ],
            title: "Bitte wähle deine Arma3.exe aus",
            properties: ['openFile']
        };
        path = String(dialog.showOpenDialog(options));
        if (path !== "undefined" && path.indexOf('\\arma3.exe') > -1) {
          path = path.replace('arma3.exe','');
          $('#armapath').val(path);
          saveallsettings();
        } else {
          storage.set('settings', {
              armapath: ''
          }, function(error) {});
          loadallsettings();
          $.Notify({
              caption: 'Bitte wähle deine Arma3.exe aus',
              content: ' ',
              type: 'alert'
          });
        }
    });

    document.getElementById("splashswitch").addEventListener("click", function() {
        splash = $("#splashswitch").is(':checked');
        saveallsettings();
    });

    document.getElementById("introswitch").addEventListener("click", function() {
        intro = $("#introswitch").is(':checked');
        saveallsettings();
    });

    document.getElementById("htswitch").addEventListener("click", function() {
        ht = $("#htswitch").is(':checked');
        saveallsettings();
    });

    document.getElementById("windowedswitch").addEventListener("click", function() {
        windowed = $("#windowedswitch").is(':checked');
        saveallsettings();
    });

    $("#meminput").on('change keydown paste input', function(){
        mem = $("#meminput").val();
        saveallsettings();
    });

    $("#cpuinput").on('change keydown paste input', function(){
        cpu = $("#cpuinput").val();
        saveallsettings();
    });

    $("#vraminput").on('change keydown paste input', function(){
        vram = $("#vraminput").val();
        saveallsettings();
    });

    $("#threadinput").on('change keydown paste input', function(){
        thread = $("#threadinput").val();
        saveallsettings();
    });

    function saveallsettings() {
        storage.set('settings', {
            armapath: path,
            splash: splash,
            intro: intro,
            ht: ht,
            windowed: windowed,
            mem: mem,
            cpu: cpu,
            vram: vram,
            thread: thread
        }, function(error) {});
        if(timert) {
          $.Notify({
              caption: 'Änderungen gespeichert',
              content: ' ',
              type: 'success'
          });
          timert = false;
          setTimeout(function() { timert = true; }, 2000);
        };
    }

    function loadallsettings() {
        storage.get('settings', function(error, data) {
            path = data.armapath;
            splash = data.splash;
            intro = data.intro;
            ht = data.ht;
            windowed = data.windowed;
            mem =  data.mem;
            cpu = data.cpu;
            vram = data.vram;
            thread = data.thread;
            loadsettingstoui();
        });

    }

    function loadsettingstoui() {
      $('#armapath').val(path);
      $('#splashswitch').prop('checked', splash);
      $('#introswitch').prop('checked', intro);
      $('#htswitch').prop('checked', ht);
      $('#windowedswitch').prop('checked', windowed);
      $("#meminput").val(mem);
      $("#cpuinput").val(cpu);
      $("#vraminput").val(vram);
      $("#threadinput").val(thread);
    }

    // To protect against untrusted code execution, all functions are required to be marked as supported for processing before they can be used inside a data-win-options attribute in HTML markup.
    WinJS.Utilities.markSupportedForProcessing(toggleWifi);

    WinJS.UI.processAll();
</script>
