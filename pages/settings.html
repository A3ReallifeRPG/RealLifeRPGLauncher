<h2 class="win-h2">Settings</h2>
<br/>
<br/>
<div class="container">
    <div class="row">
        <h3 class="win-h3">Arma Pfad</h3>
        <br/>
        <div class="input-group">
            <input type="text" id="armapath" class="form-control" placeholder="C:\Program Files (x86)\Steam\SteamApps\common\Arma 3" aria-describedby="basic-addon2" disabled="true">
            <span class="input-group-btn">
                <button class="btn btn-secondary" id="armapathbtn" type="button">...</button>
              </span>
        </div>
    </div>
    <br/>
    <div class="row">
        <h3 class="win-h3">Arma Startparameter</h3>
        <div class="col-md-12">
            <table>
                <tr>
                    <td>
                        <h5 class="win-h5">Kein Splashscreen:&nbsp;&nbsp;</h5>
                    </td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" id="splashswitch">
                            <span class="check"></span>
                        </label>
                    </td>

                    <td>
                        <h5 class="win-h5">Max. Mem:&nbsp;&nbsp;</h5>
                    </td>
                    <td>
                        <input type="number" id="meminput" class="input-control number" style="color:#444444">
                    </td>

                </tr>
                <tr>
                    <td>
                        <h5 class="win-h5">Intro Überspringen:&nbsp;&nbsp;</h5>
                    </td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" id="introswitch">
                            <span class="check"></span>
                        </label>
                    </td>

                    <td>
                        <h5 class="win-h5">CPU Count:&nbsp;&nbsp;</h5>
                    </td>
                    <td>
                        <input type="number" id="cpuinput" class="input-control number" style="color:#444444">
                    </td>
                </tr>
                <tr>
                    <td>
                        <h5 class="win-h5">Nutze Hyper-threading:&nbsp;&nbsp;</h5>
                    </td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" id="htswitch">
                            <span class="check"></span>
                        </label>
                    </td>

                    <td>
                        <h5 class="win-h5">Max. vRAM:&nbsp;&nbsp;</h5>
                    </td>
                    <td>
                        <input type="number" id="vraminput" class="input-control number" style="color:#444444">
                    </td>
                </tr>
                <tr>
                    <td>
                        <h5 class="win-h5">Fenstermodus:&nbsp;&nbsp;</h5>
                    </td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" id="windowedswitch">
                            <span class="check"></span>
                        </label>
                    </td>

                    <td>
                        <h5 class="win-h5">Ex. Threads:&nbsp;&nbsp;</h5>
                    </td>
                    <td>
                        <input type="number" id="threadinput" class="input-control number" style="color:#444444">
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        loadallsettings();
    });

    var toggleWifi = function() {
        var obj = document.getElementById("wifiToggle").winControl;
        console.log("Wifi toggled. Current status: " + (obj.checked ? "on" : "off"));
    }

    document.getElementById("armapathbtn").addEventListener("click", function() {
        var options = {
            filters: [{
                name: 'Arma3.exe',
                extensions: ['exe']
            }, ],
            title: "Bitte wähle deine Arma3.exe aus",
            properties: ['openFile']
        };
        path = dialog.showOpenDialog(options);
        $('#armapath').val(path);
        saveallsettings();
    });

    document.getElementById("splashswitch").addEventListener("click", function() {
        splash = $("#splashswitch").is(':checked');
        saveallsettings();
    });

    document.getElementById("introswitch").addEventListener("click", function() {
        intro = $("#introswitch").is(':checked');
        saveallsettings();
    });

    document.getElementById("htswitch").addEventListener("click", function() {
        ht = $("#htswitch").is(':checked');
        saveallsettings();
    });

    document.getElementById("windowedswitch").addEventListener("click", function() {
        windowed = $("#windowedswitch").is(':checked');
        saveallsettings();
    });

    $("#meminput").on('change keydown paste input', function(){
        mem = $("#meminput").val();
        saveallsettings();
    });

    $("#cpuinput").on('change keydown paste input', function(){
        cpu = $("#cpuinput").val();
        saveallsettings();
    });

    $("#vraminput").on('change keydown paste input', function(){
        vram = $("#vraminput").val();
        saveallsettings();
    });

    $("#threadinput").on('change keydown paste input', function(){
        thread = $("#threadinput").val();
        saveallsettings();
    });

    function saveallsettings() {
        storage.set('settings', {
            armapath: path,
            splash: splash,
            intro: intro,
            ht: ht,
            windowed: windowed,
            mem: mem,
            cpu: cpu,
            vram: vram,
            thread: thread
        }, function(error) {});
        $.Notify({
            caption: 'Änderungen gespeichert',
            content: 'Notify content',
            type: 'success'
        });
    }

    function loadallsettings() {
        storage.get('settings', function(error, data) {
            path = data.armapath;
            splash = data.splash;
            intro = data.intro;
            ht = data.ht;
            windowed = data.windowed;
            mem =  data.mem;
            cpu = data.cpu;
            vram = data.vram;
            thread = data.thread;
            loadsettingstoui();
        });

    }

    function loadsettingstoui() {
      $('#armapath').val(path);
      $('#splashswitch').prop('checked', splash);
      $('#introswitch').prop('checked', intro);
      $('#htswitch').prop('checked', ht);
      $('#windowedswitch').prop('checked', windowed);
      $("#meminput").val(mem);
      $("#cpuinput").val(cpu);
      $("#vraminput").val(vram);
      $("#threadinput").val(thread);
    }

    // To protect against untrusted code execution, all functions are required to be marked as supported for processing before they can be used inside a data-win-options attribute in HTML markup.
    WinJS.Utilities.markSupportedForProcessing(toggleWifi);

    WinJS.UI.processAll();
</script>
