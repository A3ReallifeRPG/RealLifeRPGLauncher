<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>RealLifeRPG Launcher v3</title>

    <script src="../config.js"></script>
    <script src="../resources/functions.js"></script>

    <script type="text/javascript">
        window.$ = window.jQuery = require('../resources/jquery/jquery-1.12.3.min.js');
    </script>

    <link rel="stylesheet" href="../resources/bootstrap/css/bootstrap.min.css">
    <script src="../resources/bootstrap/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="../resources/custom.css">

    <link href="../resources/winjs/css/ui-dark.css" rel="stylesheet" />
    <script src="../resources/winjs/js/base.js"></script>
    <script src="../resources/winjs/js/ui.js"></script>
    <link href="../resources/metroui/css/metro.css" rel="stylesheet">
    <script src="../resources/metroui/js/metro.js"></script>
    <script src="index.js"></script>
</head>

<body>
    <div id="app">
        <div class="splitView" data-win-control="WinJS.UI.SplitView">
            <!-- Pane area -->
            <div>
                <div class="header">
                    <button class="win-splitviewpanetoggle" data-win-control="WinJS.UI.SplitViewPaneToggle" data-win-options="{ splitView: select('.splitView') }"></button>
                    <div class="title">Project Husky!</div>
                </div>

                <div class="nav-commands">
                    <div class="nav-element" data-navigate="home" data-win-control="WinJS.UI.SplitViewCommand" data-win-options="{ label: 'Home', icon: 'home'}"></div>
                    <div class="nav-element" data-navigate="server" data-win-control="WinJS.UI.SplitViewCommand" data-win-options="{ label: 'Server', icon: 'world'}"></div>
                    <div class="nav-element" data-navigate="changelog" data-win-control="WinJS.UI.SplitViewCommand" data-win-options="{ label: 'Changelog', icon: 'previewlink'}"></div>
                    <div class="nav-element" data-navigate="info" data-win-control="WinJS.UI.SplitViewCommand" data-win-options="{ label: 'Info', icon: 'contact'}"></div>
                    <div class="nav-element" data-navigate="help" data-win-control="WinJS.UI.SplitViewCommand" data-win-options="{ label: 'Hilfe', icon: 'help'}"></div>
                    <div class="nav-element" data-navigate="settings" data-win-control="WinJS.UI.SplitViewCommand" data-win-options="{ label: 'Einstellungen', icon: 'settings'}"></div>
                </div>
            </div>

            <!-- Content area -->
            <div class="contenttext" id="content"></div>
        </div>

    </div>
    </div>

    <!-- Notification Dialog -->
    <div data-role="dialog" id="dialog_notf" class="padding20 dialog success" data-close-button="true" data-type="success" style="width: auto; height: auto; visibility: visible; left: 295.5px; top: 419px;">
        <h1>Wichtige Information</h1>
        <p id="dialog_notf_text">

        </p>
        <span class="dialog-close-button"></span>
    </div>
    <div data-role="dialog" id="dialog_defaultpath" class="padding20 dialog warning" data-type="warning" style="width: auto; height: auto; visibility: hidden; left: 289.5px; top: 419px;">
        <h1>Arma Pfad gefunden</h1>
        <p id="armapathtext">
        </p>
        <button class="button success" onclick="var pathdialog = $('#dialog_defaultpath').data('dialog');pathdialog.close();$('#content').load('home.html');enterPage = WinJS.UI.Animation.enterPage(anim, null);" style="float:left">Richtig</button>
        <button class="button danger" onclick="var pathdialog = $('#dialog_defaultpath').data('dialog');pathdialog.close();$('#content').load('settings.html');enterPage = WinJS.UI.Animation.enterPage(anim, null);" style="float:right">Falsch</button>
    </div>
</body>
<script>
    var fs = require('fs');

    WinJS.UI.processAll().done(function() {
        var splitView = document.querySelector(".splitView").winControl;
        new WinJS.UI._WinKeyboard(splitView.paneElement); // Temporary workaround: Draw keyboard focus visuals on NavBarCommands
    });

    var anim = document.getElementById("content");
    $(".nav-element").click(function() {
        $("#content").load($(this).attr("data-navigate") + ".html");
        enterPage = WinJS.UI.Animation.enterPage(anim, null);
    });

    $(document).ready(function() {
        storage.get('settings', function(error, data) {
            if (jQuery.isEmptyObject(data)) {
                regKey = new Winreg({ // new operator is optional
                    hive: Winreg.HKLM, // HKEY_LOCAL_MACHINE
                    key: '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\Steam App 107410' // Arma 3 Key
                })

                regKey.keyExists(function(err, exists /* array of RegistryItem */ ) {
                    if (exists) {
                        regKey.values(function(err, items /* array of RegistryItem */ ) {
                            path = items[3].value;
                            try {
                                filepath = fs.lstatSync(path);
                                if (filepath.isFile()) {
                                    var pathdialog = $('#dialog_defaultpath').data('dialog');
                                    $('#armapathtext').html(path);
                                    pathdialog.open();
                                    storage.set('settings', {
                                        armapath: path
                                    }, function(error) {});
                                };
                            } catch (e) {
                                checkregkey3();
                            }
                        });
                    } else {
                        checkregkey3();
                    }
                });
            };
        });
    });

    function checkregkey2() {
        regKey2 = new Winreg({ // new operator is optional
            hive: Winreg.HKLM, // HKEY_LOCAL_MACHINE
            key: '\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\Steam App 107410' // Arma 3 Key
        })

        regKey2.keyExists(function(err, exists /* array of RegistryItem */ ) {
            if (exists) {
                regKey2.values(function(err, items /* array of RegistryItem */ ) {
                    path = items[0].value;
                    try {
                        filepath = fs.lstatSync(path);
                        if (filepath.isFile()) {
                            var pathdialog = $('#dialog_defaultpath').data('dialog');
                            $('#armapathtext').html(path);
                            pathdialog.open();
                            storage.set('settings', {
                                armapath: path
                            }, function(error) {});
                        };
                    } catch (e) {
                        checkregkey3();
                    }
                });
            } else {
                checkregkey3();
            }
        });
    };

    function checkregkey3() {
        regKey3 = new Winreg({ // new operator is optional
            hive: Winreg.HKLM, // HKEY_LOCAL_MACHINE
            key: '\\SOFTWARE\\WOW6432Node\\bohemia interactive studio\\ArmA 3' // Arma 3 Key
        })

        regKey3.keyExists(function(err, exists /* array of RegistryItem */ ) {
            if (exists) {
                regKey3.values(function(err, items /* array of RegistryItem */ ) {
                    path = items[0].value;
                    try {
                        filepath = fs.lstatSync(path);
                        if (filepath.isFile()) {
                            var pathdialog = $('#dialog_defaultpath').data('dialog');
                            $('#armapathtext').html(path);
                            pathdialog.open();
                            storage.set('settings', {
                                armapath: path
                            }, function(error) {});
                        };
                    } catch (e) {

                        storage.set('settings', {
                            armapath: ''
                        }, function(error) {});
                        $('#content').load('settings.html');
                        enterPage = WinJS.UI.Animation.enterPage(anim, null);
                    }
                });
            } else {
                storage.set('settings', {
                    armapath: ''
                }, function(error) {});
                $('#content').load('settings.html');
                enterPage = WinJS.UI.Animation.enterPage(anim, null);
            }
        });
    };
</script>

</html>
